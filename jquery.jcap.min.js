/**
 * jCaps - jQuery plugin for caption support in HTML5 video.
 * Based on an implementation by Bruce Lawson, Philip JÃ¤genstedt, and Daniel Davis:
 * http://dev.opera.com/articles/view/accessible-html5-video-with-javascripted-captions/
 *
 * http://www.360innovate.co.uk / John McCollum
 *
 * Licensed under the Creative Commons BSD Licence, as per original work
 * http://creativecommons.org/licenses/BSD/
 *
 * Version: 0.19 (.srt but scraggy)
 */


"use strict";(function(c){var a=[];var d={aa:"Afar",ab:"Abkhazian",ae:"Avestan",af:"Africaans",ak:"Akan",am:"Amharic",an:"Aragonese",anp:"Angika",ar:"Arabic","ar-ae":"Arabic (U.A.E.)","ar-bh":"Arabic (Bahrain)","ar-dz":"Arabic (Algeria)","ar-eg":"Arabic (Egypt)","ar-iq":"Arabic (Iraq)","ar-jo":"Arabic (Jordan)","ar-kw":"Arabic (Kuwait)","ar-lb":"Arabic (Lebanon)","ar-ly":"Arabic (Libya)","ar-ma":"Arabic (Morocco)","ar-om":"Arabic (Oman)","ar-qa":"Arabic (Qatar)","ar-sa":"Arabic (Saudi Arabia)","ar-sy":"Arabic (Syria)","ar-tn":"Arabic (Tunisia)","ar-ye":"Arabic (Yemen)",as:"Assamese",ast:"Asturian",av:"Avaric",ay:"Aymara",az:"Azerbaijani",ba:"Bashkir",be:"Belarusian",bg:"Bulgarian","bg-bg":"Bulgarian (Bulgaria)",bh:"Bihari",bi:"Bislama",bm:"Bambara",bn:"Bengali",bo:"Tibetan",br:"Breton",bs:"Bosnian",ca:"Catalan","ca-es":"Catalan (Catalan)",ce:"Chechen",ch:"Chamorro",co:"Corsican",cr:"Cree",cs:"Czech","cs-cz":"Czech (Czech Republic)",cu:"Church Slavic",cv:"Cuvash",cy:"Welsh",da:"Danish","da-dk":"Danish (Denmark)",de:"German","de-at":"German (Austria)","de-ch":"German (Swiss)","de-de":"German (Germany)","de-li":"Deutsch (Lichtenstein)","de-lu":"Deutsch (Luxemburg)",dv:"Divehi",dz:"Dzongkha",ee:"Ewe",el:"Greek",en:"English","en-au":"English (Australia)","en-bz":"English (Belize)","en-ca":"English (Canada)","en-gb":"English (Great Britan)","en-ie":"English (Ireland)","en-jm":"English (Jamaica)","en-nz":"English (New Zealand)","en-ph":"English (Philippines)","en-uk":"English (Great Britan)","en-us":"English (United States)","en-tt":"English (Trinidad)","en-za":"English (South Africa)","en-zw":"English (Zimbabwe)",eo:"Ensperanto",es:"Spanish","es-ar":"Spanish (Argentina)","es-bo":"Spanish (Bolivia)","es-cl":"Spanish (Chile)","es-co":"Spanish (Colombia)","es-cr":"Spanish (Costa Rica)","es-do":"Spanish (Dominican Republic)","es-ec":"Spanish (Ecuador)","es-es":"Spanish (Spain)","es-gt":"Spanish (Guatemala)","es-hn":"Spanish (Honduras)","es-sv":"Spanish (El Salvador)","es-mx":"Spanish (Mexico)","es-nt":"Spanish (Nicaragua)","es-pa":"Spanish (Panama)","es-pe":"Spanish (Peru)","es-pr":"Spanish (Puerto Rico)","es-py":"Spanish (Paraguay)","es-uy":"Spanish (Uruguay)","es-ve":"Spanish (Venezuela)",et:"Estonian",eu:"Basque",fa:"Persian",ff:"Fulah",fi:"Finnish",fj:"Fijian",fo:"Faroese",fr:"French","fr-be":"French (Belgium)","fr-ca":"French (Canada)","fr-ch":"French (Swiss)","fr-fr":"French (France)","fr-lu":"French (Luxemburg)","fr-mc":"French (Mexico)",frr:"Frisian",fy:"Western Frisian",ga:"Irish",gd:"Gaelic",gl:"Galician",gn:"Guarani",gu:"Gujarati",gv:"Manx",ha:"Hausa",he:"Hebrew",hi:"Hindi",ho:"Hiri Motu",hr:"Croatian",hsb:"High Sorbian",ht:"Haitian",hu:"Hungarian",hy:"Armenian",hz:"Herero",ia:"Interlingua",id:"Indonesian",ie:"Interlingue",ig:"Igbo",ii:"Sichuan Yi",ik:"Inupiaq","in":"Indonesian",io:"Ido",is:"Icelandic",it:"Italian","it-ch":"Italian (Swiss)",iu:"Inuktitut",iw:"Hebrew",ja:"Japanese",ji:"Yiddish",jv:"Javanese",ka:"Georian",kg:"Kongo",ki:"Kikuyu",kj:"Kuanyama",kk:"Kasakh",kl:"Kalaallisut",km:"Central Khmer",kn:"Kannada",ko:"Korean","ko-kp":"Korean (North Korea)","ko-kr":"Korean (South Korea)",kr:"Kanuri",ks:"Kashmiri",ku:"Kurdish",kv:"Komi",kw:"Cornish",ky:"Kyrgyz",la:"Latin",lb:"Luxembourgish",lg:"Ganda",li:"Limburgan",ln:"Lingala",lo:"Lao",lt:"Lithuanian",lu:"Luba-Katanga",lv:"Latvian",mg:"Malagasy",mh:"Marshallese",mi:"Maori",mk:"Macedonian","mk-mk":"Macedonian (F.J.R. Macedonia)",ml:"Malayalam",mn:"Mongolian",mo:"Moldavian",mr:"Marathi",ms:"Malay",mt:"Maltese",my:"Burmese",na:"Nauru",nb:"Nowegian Bokm&#xE5;l",nd:"North Ndebele",ne:"Nepali",ng:"Ndonga",nl:"Dutch","nl-be":"Dutch (Belgium)",nn:"Nowegian Nynorsk",no:"Nowegian",nr:"South Ndebele",nv:"Navajo",ny:"Chichewa",oc:"Occitan",oj:"Ojibwa",om:"Oromo",or:"Oriya",os:"Ossetian",pa:"Panjabi",pi:"Pali",pl:"Polish",ps:"Pushto",pt:"Portuguese","pt-br":"Portuguese (Brasil)",qu:"Quechua",rm:"Romansh",rn:"Rundi",ro:"Romanian",ru:"Russian",rw:"Kinyarwanda",sa:"Sanskit",sc:"Sardinian",sd:"Sindhi",se:"Northern Sami",sg:"Sango",sh:"Serbo-Croatian",si:"Sinhala",sk:"Slovak",sl:"Slovenian",sm:"Samoan",sn:"Shona",so:"Somali",sq:"Albanian",sr:"Serbian",ss:"Swati",st:"Southern Sotho",su:"Sundanese",sv:"Swedish","sv-fi":"Swedisch (Finnland)",sw:"Swahili",ta:"Tamil",te:"Telugu",tg:"Tajik",th:"Thai",ti:"Tigrinya",tk:"Turkmen",tl:"Tagalog",tn:"Tswana",to:"Tonga",tr:"Turkish",ts:"Tsonga",tt:"Tatar",tw:"Twi",ty:"Tahitian",ug:"Uighur",uk:"Ukrainian",ur:"Urdu",uz:"Uzbek",ve:"Venda",vi:"Vietnamese",vo:"Volap&#xFC;k",wa:"Walloon",wo:"Wolof",xh:"Xhosa",yi:"Yiddish",yo:"Yoruba",za:"Zhuang",zh:"Chinese","zh-chs":"Chinese (Simplified)","zh-cht":"Chinese (Traditional)","zh-cn":"Chinese (People's Republic of China)","zh-guoyu":"Mandarin","zh-hk":"Chinese (Hong Kong S.A.R.)","zh-min-nan":"Min-Nan","zh-mp":"Chinese (Macau S.A.R.)","zh-sg":"Chinese (Singapore)","zh-tw":"Chinese (Taiwan)","zh-xiang":"Xiang",zu:"Zulu"};var b={transcriptsDiv:null,transcriptType:"ajax",language:c("html").attr("lang"),languageChooser:true,interfaceImg:"speechbubble.gif",toggleButton:true,onButton:true,offButton:true,transcriptButton:true,showCaptions:false,switchOnCallback:function(){},switchOffCallback:function(){},debug:false};c.jCaps_plugin={_init:function(){var f=c(this);var g=c.jCaps_plugin._getInterfaceDiv();if(b.languageChooser){var j=c.jCaps_plugin._getLanguageDropdown(f);g.children("div#jCapsInterface").append(j)}if(b.toggleButton){var k=c.jCaps_plugin._getToggleButton();g.children("div#jCapsInterface").append(k)}if(b.onButton){var h=c.jCaps_plugin._getOnButton();g.children("div#jCapsInterface").append(h)}if(b.offButton){var e=c.jCaps_plugin._getOffButton();g.children("div#jCapsInterface").append(e)}f.after(g).show();if(b.debug){c.jCaps_plugin._tests()}return c.jCaps_plugin._getCaptions(f)},_getInterfaceDiv:function(){var f=c("<div/>",{id:"jCapsInterfaceWrapper"});var e=c("<div/>",{id:"jCapsShowHide",css:{width:"60px",cursor:"pointer",height:"60px",background:"url("+b.interfaceImg+") no-repeat center left",paddingLeft:"30px"}}).toggle(function(){c("#jCapsInterface").children().stop().fadeIn(1000)},function(){c("#jCapsInterface").children().stop().fadeOut(500)}).appendTo(f);var g=c("<div/>",{id:"jCapsInterface"}).appendTo(f);return f},_getCaptions:function(j){if(b.transcriptType=="ajax"){var f=j.find('track[language="'+b.language+'"]');var k=f.attr("type");switch(k){case"text/srt":var g=f.attr("src");c.ajax({type:"GET",url:g,dataType:"text",success:function(l){var n=l.split("\r\n\r\n");for(i=0;i<n.length;++i){var m=[];m=n[i].split("\r\n");a[i]=[];a[i][0]=m[2];a[i][1]=c.jCaps_plugin._parseTimestamp(m[1].split("-->")[0]);a[i][2]=c.jCaps_plugin._parseTimestamp(m[1].split("-->")[1])}},error:function(){alert("There was a problem retrieving captions for this video.")},complete:function(){if(b.debug){fireunit.ok(a.length>0,"Captions array shouldn't be empty.")}}});break;case"application/ttaf+xml":alert("todo: timedtext");break}}else{if(b.transcriptType=="html"){if(b.transcriptsDiv!==null){b.transcriptsDiv.hide();var h=c(b.transcriptsDiv).children('div[lang="'+b.language+'"]').find("span");for(i=0;i<h.length;++i){a[i]=[];var e=c(h[i]);a[i][0]=e.text();a[i][1]=e.attr("data-begin");a[i][2]=e.attr("data-end")}return a}}}return a},_parseTimestamp:function(f){var g=f.split(/,/)[1];var k=f.split(/,/)[0];var e=k.split(/:/)[0];var h=k.split(/:/)[1];var l=k.split(/:/)[2];var j=parseInt(e*60*60,10)+parseInt(h*60,10)+parseInt(l,10);return parseFloat(j+"."+g,10)},_appendAria:function(e){var f=[];var g=b.transcriptsDiv.children("div");c.each(g,function(j,k){k=c(k);if(!k.attr("id")){var h=d[k.attr("lang")]+"_language_transcript";k.attr("id",h)}else{var h=k.attr("id")}f.push(h)});e.attr("aria-describedby",f.join(" "))},_getOnButton:function(){var e=c("<a/>",{href:"#",text:"switch on",css:{display:"none"},click:function(f){f.preventDefault();c.jCaps_plugin.switchOn()}});return e},_getOffButton:function(){var e=c("<a/>",{href:"#",text:"switch off",css:{display:"none"},click:function(f){f.preventDefault();c.jCaps_plugin.switchOff()}});return e},_getToggleButton:function(){var e=c("<a/>",{href:"#",text:"toggle captions",css:{display:"none"},click:function(f){f.preventDefault();c.jCaps_plugin.toggleCaptions()}});return e},_getLanguageDropdown:function(h){var g=h.find('track[language^=""]');var f=c("html").attr("lang");var e=c("<select/>",{change:function(){c.jCaps_plugin.switchLanguage(c(this).val(),h)},css:{display:"none"}});var j=c("<option/>",{text:"choose...",value:""}).appendTo(e);c.each(g,function(l,k){var n=c(k).attr("language");var m=c("<option/>",{text:d[n],value:n});if(f===n){m.attr("selected","selected")}m.appendTo(e)});return e},switchOn:function(){b.showCaptions=true;return},switchOff:function(){b.showCaptions=false;return},toggleCaptions:function(){b.showCaptions=!b.showCaptions;return},switchLanguage:function(f,e){b.language=f;a=c.jCaps_plugin._getCaptions(e);return},swapOut:function(){b.transcriptsDiv.show();b.transcriptsDiv.children().show();b.transcriptsDiv.children("div").not('div[lang="'+b.language+'"]').hide();return},_tests:function(){if(typeof fireunit==="object"){if(b.transcriptType=="html"){fireunit.ok(a.length>0,"Captions array shouldn't be empty.");fireunit.ok(c(b.transcriptsDiv).is(":hidden"),"Transcripts div should be hidden.")}else{if(b.transcriptType=="subrip"){}}fireunit.ok(c("#jCapsInterfaceWrapper").length,"#jCapsInterfaceWrapper must exist.");fireunit.ok(c("#jCapsInterface").length,"#jCapsInterface must exist.");fireunit.ok(function(){values=[["01:00:03,000",3603],["00:00:55,600",55.6]];var f=true;for(var e=0;e<values.length;++e){if(c.jCaps_plugin._parseTimestamp(values[e][0])!=values[e][1]){f=false}}return f}(),"parseTimeStamp should return the expected values");fireunit.ok(function(){return c("#jCapsInterface").children(":hidden").length===c("#jCapsInterface").children().length}(),"jCaps interface elements should be initially hidden");fireunit.ok(function(){var f=c("#jCapsShowHide");fireunit.click(f);var e=c("#jCapsInterface").children(":hidden").length===0;fireunit.click(f);return e}(),"Clicking #jCapsShowHide should show interface elements")}else{if(typeof window.console==="object"){window.console.log("Please install FireUnit to view test results. (http://fireunit.org/)")}}}};c.fn.jCaps=function(e){if(typeof e==="object"){c.extend(b,e)}else{if(typeof e==="string"){switch(e){case"switchOn":return c.jCaps_plugin.switchOn.call(this);case"switchOff":return c.jCaps_plugin.switchOff.call(this);case"toggle":return c.jCaps_plugin.toggle.call(this);case"swapOut":return c.jCaps_plugin.swapOut.call(this)}}}this.each(function(){var f=c.jCaps_plugin._init.call(this);var g=c(this);g.css("position","relative");var j=c("<div/>",{id:"jCapsWrapper",css:{position:"relative",display:"inline"}});g.wrap(j);if(!c("div#captions").length){var h=c("<div/>",{id:"captions",width:this.width,css:{display:"none",position:"absolute",top:"15px",opacity:0.7}});c("<p>").appendTo(h);h.appendTo(c("#jCapsWrapper"))}g.bind("timeupdate",function(){var k=this.currentTime;var l="";c.each(f,function(n,m){if(k>=m[1]&&k<=m[2]){var o=m[0];if(o!==l){l=o;c("#captions").text(o);return true}}});if(b.showCaptions){if(c("div#captions").is(":hidden")){c("div#captions").show();b.switchOnCallback()}}else{if(!c("div#captions").is(":hidden")){c("div#captions").hide();b.switchOffCallback()}}})});return this}})(jQuery);
